<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dales CPC Presentation Pacing Timer v1.003</title>
<style>
  :root{
    --bg:#0e0e12; --panel:#16161d; --border:#2a2a36; --text:#eaeaea;
    --accent:#8b5cf6;
  }
  *{box-sizing:border-box}
  body{margin:0;padding:2rem;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  h1{font-size:1.25rem;margin:0 0 1rem 0;opacity:.95}
  .ver{opacity:.7;font-weight:600}
  .card{max-width:980px;margin:auto;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:1rem 1.25rem 1.25rem;}
  .layout{display:grid;grid-template-columns:2fr 1fr;gap:1rem;align-items:start}

  /* Inputs */
  .row{display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:1rem;}
  .field{flex:1 1 160px;max-width:210px}
  label{display:block;font-size:.82rem;margin:0 0 .25rem .1rem;opacity:.85;white-space:nowrap}
  input{width:100%;padding:.45rem .55rem;border-radius:10px;border:1px solid var(--border);background:#0f0f15;color:var(--text);font-size:.95rem;}

  /* Buttons */
  .controls{display:flex;gap:.6rem;flex-wrap:wrap;margin:.2rem 0 1rem;}
  button{cursor:pointer;border:1px solid var(--border);background:#1f1f2b;color:var(--text);border-radius:12px;padding:.55rem .85rem;font-size:1rem}
  button.primary{background:var(--accent);border-color:var(--accent);}
  button:disabled{opacity:.55;cursor:not-allowed}

  /* Display tiles */
  .display{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;margin-top:.4rem}
  .tile{background:#0f0f15;border:1px solid var(--border);border-radius:14px;padding:1rem;text-align:center}
  .tile .label{font-size:.8rem;opacity:.75;margin-bottom:.35rem}
  .tile .value{font-size:2rem;font-variant-numeric:tabular-nums}

  /* Progress */
  .progress-wrap{margin-top:.9rem}
  .progress-label{display:flex;justify-content:space-between;font-size:.85rem;opacity:.85;margin-bottom:.35rem}
  .progress{position:relative;height:14px;background:#0f0f15;border:1px solid var(--border);border-radius:999px;overflow:hidden}
  .bar{position:absolute;left:0;top:0;bottom:0;width:0%;background:var(--accent);transition:width .2s linear}
  .progtext{margin-top:.35rem;font-size:.9rem;opacity:.9;text-align:center}

  .hint{font-size:.9rem;opacity:.85;margin-top:.75rem}
  .fine{color:#7ee787}
  .bad{color:#ff6b6b}

  /* Log panel */
  .log{background:#0f0f15;border:1px solid var(--border);border-radius:14px;padding:1rem;align-self:start}
  .log h2{font-size:1rem;margin:0 0 .6rem 0;opacity:.95}
  .loglist{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.35rem;max-height:calc(100vh - 300px);overflow:auto}
  .loglist li{font-size:.9rem;opacity:.95}
  .loglist .time{opacity:.7}

  @media (max-width:900px){
    .layout{grid-template-columns:1fr}
    .display{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="card">
    <h1>Dales CPC Presentation Pacing Timer <span class="ver">v1.003</span></h1>

    <div class="layout">
      <!-- LEFT -->
      <div>
        <div class="row">
          <div class="field">
            <label for="slides">Number of content slides</label>
            <input id="slides" type="number" min="1" step="1" placeholder="e.g. 60" />
          </div>
          <div class="field">
            <label for="minutes">Target duration (minutes)</label>
            <input id="minutes" type="number" min="1" step="1" value="210" />
          </div>
          <div class="field">
            <label for="grace">Intro/outro buffer (min)</label>
            <input id="grace" type="number" min="0" step="1" value="0" />
          </div>
        </div>

        <div class="controls">
          <button id="start" class="primary">Start Presentation</button>
          <button id="pause" disabled>Start Break</button>
          <button id="resume" disabled>End Break</button>
          <button id="end" disabled>End Presentation</button>
          <button id="reset">Reset</button>
          <button id="fullscreen">Fullscreen</button>
        </div>

        <div class="display">
          <div class="tile">
            <div class="label">Elapsed</div>
            <div class="value" id="elapsed">00:00</div>
          </div>
          <div class="tile">
            <div class="label">You should be on slide</div>
            <div class="value" id="shouldSlide">—</div>
          </div>
          <div class="tile">
            <div class="label">Tempo</div>
            <div class="value" id="tempo">—</div>
          </div>
        </div>

        <div class="progress-wrap">
          <div class="progress-label">
            <span>Slide Progress</span>
            <span id="pct">0%</span>
          </div>
          <div class="progress"><div class="bar" id="bar"></div></div>
          <div class="progtext" id="progtext">Slide — of —</div>
        </div>

        <div class="hint" id="hint">Enter slides and minutes, then hit Start. Pause and Resume buttons are available to manage breaks.</div>
      </div>

      <!-- RIGHT -->
      <div class="log">
        <h2>Session Log</h2>
        <ul class="loglist" id="loglist"></ul>
      </div>
    </div>
  </div>

<script>
(() => {
  const slidesEl = document.getElementById('slides');
  const minutesEl = document.getElementById('minutes');
  const graceEl = document.getElementById('grace');

  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pause');
  const resumeBtn = document.getElementById('resume');
  const endBtn = document.getElementById('end');
  const resetBtn = document.getElementById('reset');
  const fsBtn = document.getElementById('fullscreen');

  const elapsedEl = document.getElementById('elapsed');
  const shouldSlideEl = document.getElementById('shouldSlide');
  const tempoEl = document.getElementById('tempo');
  const hintEl = document.getElementById('hint');

  const barEl = document.getElementById('bar');
  const pctEl = document.getElementById('pct');
  const progTextEl = document.getElementById('progtext');
  const logList = document.getElementById('loglist');

  let timer = null;
  let startTime = null;
  let pausedAt = 0;   // ms timestamp when pause started
  let accPaused = 0;  // seconds total paused

  function nowStr() {
    const d = new Date();
    const pad = n => String(n).padStart(2,'0');
    return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  }
  function addLog(msg) {
    const li = document.createElement('li');
    li.innerHTML = `<span class="time">[${nowStr()}]</span> ${msg}`;
    logList.appendChild(li);
    logList.scrollTop = logList.scrollHeight;
  }
  function fmt(seconds) {
    seconds = Math.max(0, Math.floor(seconds));
    const m = Math.floor(seconds / 60).toString().padStart(2, '0');
    const s = (seconds % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }
  function paceToWords(secPerSlide){
    if (!secPerSlide || !isFinite(secPerSlide) || secPerSlide <= 0) return '—';
    const total = Math.round(secPerSlide);
    if (total < 60) return `${total} second${total===1?'':'s'} per slide`;
    const m = Math.floor(total/60);
    const s = total % 60;
    if (s === 0) return `${m} minute${m===1?'':'s'} per slide`;
    return `${m} minute${m===1?'':'s'} and ${s} second${s===1?'':'s'} per slide`;
  }

  function update() {
    const slides = parseInt(slidesEl.value, 10);
    const mins = parseInt(minutesEl.value, 10);
    const grace = parseInt(graceEl.value || '0', 10);
    const valid = Number.isInteger(slides) && slides > 0 && Number.isInteger(mins) && mins > 0 && Number.isInteger(grace) && grace >= 0;
    if (!valid || !startTime) return;

    const now = Date.now();
    const elapsedSec = ((now - startTime) / 1000) - accPaused;
    const totalSec = mins * 60;
    const perSlide = (totalSec - grace * 60) / slides;

    const e = Math.max(0, Math.min(elapsedSec, totalSec));
    elapsedEl.textContent = fmt(e);

    let targetSlide;
    if (perSlide <= 0) {
      targetSlide = 1;
    } else {
      targetSlide = Math.floor(Math.max(0, e - grace * 60) / perSlide) + 1;
      targetSlide = Math.min(slides, Math.max(1, targetSlide));
    }
    shouldSlideEl.textContent = targetSlide;

    tempoEl.textContent = paceToWords(perSlide);

    // Progress bar
    if (slides > 0) {
      const progress = Math.max(0, Math.min(1, targetSlide / slides));
      barEl.style.width = `${progress * 100}%`;
      pctEl.textContent = `${Math.round(progress * 100)}%`;
      progTextEl.textContent = `Slide ${targetSlide} of ${slides}`;
    } else {
      barEl.style.width = '0%';
      pctEl.textContent = '0%';
      progTextEl.textContent = 'Slide — of —';
    }

    if (e >= totalSec - 0.5) {
      hintEl.innerHTML = '<span class="bad">Time’s up.</span>';
      stopTimer();
    } else if (e < grace * 60) {
      hintEl.innerHTML = '<span class="fine">Buffer time</span> before content pacing kicks in.';
    } else {
      hintEl.innerHTML = 'Glance here. If your actual slide is lower than shown, speed up. If it’s higher, slow down.';
    }
  }

  function startTimer() {
    if (timer) return;
    const slides = parseInt(slidesEl.value, 10);
    const mins = parseInt(minutesEl.value, 10);
    const grace = parseInt(graceEl.value || '0', 10);
    if (!Number.isInteger(slides) || slides <= 0 || !Number.isInteger(mins) || mins <= 0 || !Number.isInteger(grace) || grace < 0) {
      hintEl.innerHTML = '<span class="bad">Enter valid numbers for slides, minutes, and buffer.</span>';
      return;
    }
    startTime = Date.now();
    accPaused = 0; pausedAt = 0;

    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resumeBtn.disabled = true;
    endBtn.disabled = false;
    slidesEl.disabled = true; minutesEl.disabled = true; graceEl.disabled = true;

    timer = setInterval(update, 200);
    addLog('Presentation started.');
    update();
  }

  function stopTimer() {
    if (timer) { clearInterval(timer); timer = null; }
    pauseBtn.disabled = true;
    resumeBtn.disabled = true;
    startBtn.disabled = false;
  }

  function pauseTimer() {
    if (!timer) return;
    pausedAt = Date.now();
    clearInterval(timer);
    timer = null;
    pauseBtn.disabled = true;
    resumeBtn.disabled = false;
    addLog('Break started.');
  }

  function resumeTimer() {
    if (timer || !pausedAt) return;
    accPaused += (Date.now() - pausedAt) / 1000;
    pausedAt = 0;
    timer = setInterval(update, 200);
    pauseBtn.disabled = false;
    resumeBtn.disabled = true;
    addLog('Break ended.');
  }

  function endPresentation() {
    addLog('Presentation ended.');
    stopTimer();
    endBtn.disabled = true;
  }

  function resetAll() {
    stopTimer();
    startTime = null; accPaused = 0; pausedAt = 0;

    elapsedEl.textContent = "00:00";
    shouldSlideEl.textContent = "—";
    tempoEl.textContent = "—";
    barEl.style.width = '0%'; pctEl.textContent = '0%'; progTextEl.textContent = 'Slide — of —';

    slidesEl.disabled = false; minutesEl.disabled = false; graceEl.disabled = false;

    startBtn.disabled = false; pauseBtn.disabled = true; resumeBtn.disabled = true; endBtn.disabled = true;

    hintEl.textContent = "Enter slides and minutes, then hit Start. Pause and Resume buttons are available to manage breaks.";
    logList.innerHTML = '';
  }

  // Buttons
  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resumeBtn.addEventListener('click', resumeTimer);
  endBtn.addEventListener('click', endPresentation);
  resetBtn.addEventListener('click', resetAll);
  fsBtn.addEventListener('click', () => {
    const el = document.documentElement;
    if (!document.fullscreenElement) el.requestFullscreen?.();
    else document.exitFullscreen?.();
  });

  // Shortcuts
  window.addEventListener('keydown', (e) => {
    const k = e.key.toLowerCase();
    if (e.code === 'Space') { e.preventDefault(); if (!startTime) return; if (timer) pauseTimer(); else resumeTimer(); }
    else if (k === 'r') resetAll();
    else if (k === 'f') fsBtn.click();
    else if (k === 'e') endPresentation();
  });
})();
</script>
</body>
</html>
